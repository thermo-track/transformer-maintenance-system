-- Insert inspection anomalies data
-- ON CONFLICT DO NOTHING makes this idempotent (safe to run multiple times)
INSERT INTO inspection_anomalies (
    id,
    area_px,
    bbox_height,
    bbox_width,
    bbox_x,
    bbox_y,
    centroid_x,
    centroid_y,
    class_id,
    created_at,
    detected_at,
    detector_box,
    fault_confidence,
    fault_type,
    inspection_id,
    source,
    is_active,
    created_by
) VALUES
(12, 651160, 584, 1115, 552, 778, 1109.5, 1070, 0, '2025-01-01 00:58:42.6', '2025-01-01 00:58:42.6', '[552.9041748046875,778.07861328125,1115.4090576171875,584.8663330078125]', 0.580114, 'Full wire overload', 100000001, 'AI_GENERATED', true, 'system'),
(13, 148050, 315, 470, 668, 245, 903, 402.5, 3, '2025-01-01 00:00:37.3', '2025-01-01 00:00:37.3', '[668.45849609375,245.06088256835938,470.4739990234375,315.0834655761719]', 0.838216, 'Point Overload - Faulty', 100000003, 'AI_GENERATED', true, 'system'),
(14, 148050, 315, 470, 668, 245, 903, 402.5, 3, '2025-01-01 00:02:19.0', '2025-01-01 00:02:19.0', '[668.45849609375,245.06088256835938,470.4739990234375,315.0834655761719]', 0.838216, 'Point Overload - Faulty', 100000002, 'AI_GENERATED', true, 'system'),
(15, 46652, 218, 214, 950, 299, 1057, 408, 1, '2025-01-01 00:08:09.4', '2025-01-01 00:08:09.4', '[950.6728515625,299.8026428222656,214.90869140625,218.66842651367188]', 0.61924, 'Loose Joint -Faulty', 100000004, 'AI_GENERATED', true, 'system'),
(16, 125280, 290, 432, 732, 1143, 948, 1288, 4, '2025-01-01 00:10:39.9', '2025-01-01 00:10:39.9', '[732.9994506835938,1143.17333984375,432.53997802734375,290.1187744140625]', 0.812935, 'normal', 100000005, 'AI_GENERATED', true, 'system'),
(17, 103230, 310, 333, 432, 735, 598.5, 890, 4, '2025-01-01 00:10:40.0', '2025-01-01 00:10:40.0', '[432.786376953125,735.389404296875,333.2994384765625,310.0416259765625]', 0.763932, 'normal', 100000005, 'AI_GENERATED', true, 'system'),
(18, 75429, 261, 289, 1857, 776, 2001.5, 906.5, 4, '2025-01-01 00:10:40.1', '2025-01-01 00:10:40.1', '[1857.4385986328125,776.1428833007812,289.6141357421875,261.34759521484375]', 0.610598, 'normal', 100000005, 'AI_GENERATED', true, 'system'),
(19, 54488, 278, 196, 1263, 765, 1361, 904, 4, '2025-01-01 00:10:40.1', '2025-01-01 00:10:40.1', '[1263.1796875,765.5157470703125,196.9078369140625,278.771484375]', 0.544236, 'normal', 100000005, 'AI_GENERATED', true, 'system'),
(20, 103161, 251, 411, 107, 88, 312.5, 213.5, 1, '2025-01-01 00:12:43.2', '2025-01-01 00:12:43.2', '[107.92060852050781,88.2708969116211,411.72178649902344,251.43567657470703]', 0.84828, 'Loose Joint -Faulty', 100000007, 'AI_GENERATED', true, 'system'),
(21, 102090, 249, 410, 106, 90, 311, 214.5, 1, '2025-01-01 00:13:18.3', '2025-01-01 00:13:18.3', '[106.3934326171875,90.00784301757812,410.28326416015625,249.5213623046875]', 0.782227, 'Loose Joint -Faulty', 100000009, 'AI_GENERATED', true, 'system'),
(22, 103161, 251, 411, 107, 88, 312.5, 213.5, 1, '2025-01-01 00:14:50.0', '2025-01-01 00:14:50.0', '[107.92060852050781,88.2708969116211,411.72178649902344,251.43567657470703]', 0.84828, 'Loose Joint -Faulty', 100000008, 'AI_GENERATED', true, 'system'),
(23, 4368, 91, 48, 140, 75, 164, 120.5, 4, '2025-01-01 00:16:22.6', '2025-01-01 00:16:22.6', '[140.12367248535156,75.22349548339844,48.69309997558594,91.48765563964844]', 0.889113, 'normal', 100000010, 'AI_GENERATED', true, 'system'),
(24, 4324, 92, 47, 89, 76, 112.5, 122, 4, '2025-01-01 00:16:22.6', '2025-01-01 00:16:22.6', '[89.86524200439453,76.91632080078125,47.559165954589844,92.89599609375]', 0.888318, 'normal', 100000010, 'AI_GENERATED', true, 'system'),
(25, 4508, 92, 49, 36, 77, 60.5, 123, 1, '2025-01-01 00:16:22.6', '2025-01-01 00:16:22.6', '[36.08912658691406,77.51872253417969,49.94121551513672,92.73809814453125]', 0.779223, 'Loose Joint -Faulty', 100000010, 'AI_GENERATED', true, 'system'),
(26, 17100, 180, 95, 272, 149, 319.5, 239, 4, '2025-01-01 00:17:09.5', '2025-01-01 00:17:09.5', '[272.7576904296875,149.53916931152344,95.38629150390625,180.4898223876953]', 0.878304, 'normal', 100000011, 'AI_GENERATED', true, 'system'),
(27, 19897, 197, 101, 65, 139, 115.5, 237.5, 1, '2025-01-01 00:17:09.6', '2025-01-01 00:17:09.6', '[65.32919311523438,139.19078063964844,101.15293884277344,197.50880432128906]', 0.662108, 'Loose Joint -Faulty', 100000011, 'AI_GENERATED', true, 'system'),
(28, 4700, 94, 50, 140, 77, 165, 124, 4, '2025-01-01 00:17:50.5', '2025-01-01 00:17:50.5', '[140.06484985351562,77.99740600585938,50.591644287109375,94.21420288085938]', 0.888976, 'normal', 100000012, 'AI_GENERATED', true, 'system'),
(29, 5880, 120, 49, 88, 51, 112.5, 111, 1, '2025-01-01 00:17:50.5', '2025-01-01 00:17:50.5', '[88.59402465820312,51.8615837097168,49.41300964355469,120.40384292602539]', 0.645268, 'Loose Joint -Faulty', 100000012, 'AI_GENERATED', true, 'system'),
(30, 6188, 119, 52, 33, 54, 59, 113.5, 1, '2025-01-01 00:17:50.5', '2025-01-01 00:17:50.5', '[33.07270050048828,54.32936477661133,52.341552734375,119.95469284057617]', 0.626095, 'Loose Joint -Faulty', 100000012, 'AI_GENERATED', true, 'system'),
(31, 13515, 159, 85, 1166, 639, 1208.5, 718.5, 1, '2025-01-01 00:21:51.6', '2025-01-01 00:21:51.6', '[1166.11572265625,639.0735473632812,85.45947265625,159.84625244140625]', 0.568875, 'Loose Joint -Faulty', 100000013, 'AI_GENERATED', true, 'system'),
(32, 13515, 159, 85, 1166, 639, 1208.5, 718.5, 1, '2025-01-01 00:22:42.9', '2025-01-01 00:22:42.9', '[1166.11572265625,639.0735473632812,85.45947265625,159.84625244140625]', 0.568875, 'Loose Joint -Faulty', 100000014, 'AI_GENERATED', true, 'system'),
(33, 13515, 159, 85, 1166, 639, 1208.5, 718.5, 1, '2025-01-01 00:23:29.0', '2025-01-01 00:23:29.0', '[1166.11572265625,639.0735473632812,85.45947265625,159.84625244140625]', 0.568875, 'Loose Joint -Faulty', 100000015, 'AI_GENERATED', true, 'system')
ON CONFLICT (id) DO UPDATE SET
    source = EXCLUDED.source,
    is_active = EXCLUDED.is_active,
    created_by = EXCLUDED.created_by;

-- Ensure the inspection_anomalies sequence is in sync with the current data to avoid
-- duplicate key errors when the DB already contains anomaly rows (eg. persistent volumes).
SELECT setval('inspection_anomalies_id_seq', COALESCE((SELECT MAX(id) FROM inspection_anomalies), 0), true);

-- Verification query
SELECT 
    COUNT(*) as total_records,
    COUNT(DISTINCT inspection_id) as unique_inspections,
    fault_type,
    COUNT(*) as count_by_fault_type,
    ROUND(AVG(fault_confidence)::numeric, 3) as avg_confidence
FROM inspection_anomalies 
GROUP BY fault_type
ORDER BY count_by_fault_type DESC;